import { gsap } from "gsap";
import { MotionPathPlugin } from "gsap/MotionPathPlugin.js";
import React, { useEffect } from "react";

const Track = () => {
  var offsetFromTop, pathBB, startY, finishDistance;
  var requestId;
  var tween;

  function update() {
    // Update our animation
    var value = (window.scrollY - startY) / pathBB.height;
    if (value < 1) tween.progress(value);
    //console.clear();
    console.log("distance Travelled:", window.scrollY - startY);
    console.log(
      "offsetFromTop",
      offsetFromTop,
      "window.scrollY",
      window.scrollY,
      "startY",
      startY,
      "pathBB",
      pathBB,
      "finishDistance",
      finishDistance,
      "value",
      value
    );
    // Let the scroll event fire again
    requestId = null;
  }

  useEffect(() => {
    window.scrollTo(0, 0);

    //console.clear();
    //register the plugin
    gsap.registerPlugin(MotionPathPlugin);

    // set the element to rotate from it's center
    // gsap.set([".rocket", ".rocket--self"], {
    // 	xPercent: -50,
    // 	yPercent: -50,
    // 	transformOrigin: "50% 50%"
    // });

    offsetFromTop = window.innerHeight * 0.5; //Vcenter of screen
    pathBB = document.querySelector("#path").getBoundingClientRect();
    startY = pathBB.top - offsetFromTop * 1;
    finishDistance = startY + pathBB.height - offsetFromTop;

    // the animation to use
    tween = gsap.to(".rocket", {
      paused: true,
      ease: "none",

      motionPath: {
        path: "#path",
        align: "#path",
        autoRotate: false,
        alignOrigin: [0.5, 0.5],
        start: 0.007,
      },
    });

    document.addEventListener("scroll", function () {
      // Prevent the update from happening too often (throttle the scroll event)
      if (!requestId) {
        requestId = requestAnimationFrame(update);
      }
    });

    update();
  }, []);

  return (
    <div className=" w-full h-full px-10  z-1   ">
      <svg
        className=""
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 1200 2900"
      >
        <svg
          viewBox="0 0 1056 6500"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            id="path"
            d="M539 1.5C619.5 252 4-23 4 368.5c0 488 1005 211.927 1005 749.46 0 506.04-986 149-977.5 704.5S1062 2022 1062 2554.5c0 418.5-1033.5 231.5-1022 729 9.8 423.92 487.5 177.5 495 611"
            stroke="#E1E1E1"
            stroke-width="7"
            vector-effect="non-scaling-stroke"
            stroke-dasharray="14 14"
          />
        </svg>

        <g class="rocket">
          <svg
            width="97"
            height="95"
            viewBox="0 0 97 95"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M68.7319 5.73053C62.6786 2.98129 56.1058 1.56344 49.4575 1.5728C23.7058 1.57171 2.82959 22.4468 2.82959 48.1985C2.83162 60.5639 7.74502 72.4221 16.4892 81.1652C25.2333 89.9084 37.0921 94.8204 49.4575 94.8209C75.2081 94.8209 96.0843 73.9447 96.0843 48.1941C96.0843 29.3213 84.8661 13.0635 68.7319 5.73053ZM25.6227 79.5314C16.1781 72.3396 10.0881 60.9803 10.0881 48.1985C10.0881 26.4547 27.7136 8.82914 49.4575 8.82914C54.5277 8.82291 59.5511 9.79861 64.2503 11.7024L64.6398 11.8643L64.7809 11.9223L64.9888 12.012C69.8198 14.0907 74.1864 17.1144 77.8318 20.9052C70.9108 15.1638 62.1974 12.0281 53.2049 12.0426C31.8692 12.0426 14.5818 29.3366 14.5818 50.6658C14.5818 65.6687 23.1357 78.6758 35.6341 85.0711C32.0428 83.7238 28.6683 81.8574 25.6184 79.5314H25.6227Z"
              fill="#945EF2"
            />
            <path
              d="M66.6268 4.4068C60.5735 1.65756 54.0007 0.23971 47.3524 0.249069C21.6007 0.249069 0.725586 21.1242 0.725586 46.8759C0.726747 59.2416 5.63961 71.1005 14.3836 79.8443C23.1276 88.5881 34.9867 93.5007 47.3524 93.5016C73.103 93.5016 93.9792 72.6254 93.9792 46.8748C93.9792 27.9976 82.761 11.7397 66.6268 4.4068ZM23.5089 78.2077C14.0741 71.0159 7.98302 59.6565 7.98302 46.8748C7.98302 25.1309 25.6085 7.50869 47.3524 7.50869C52.4226 7.50246 57.446 8.47816 62.1452 10.3819L62.5347 10.5438L62.6758 10.6018L62.8837 10.6915C67.7147 12.7703 72.0813 15.7939 75.7267 19.5847C68.8057 13.8433 60.0923 10.7076 51.0998 10.7222C29.7641 10.7222 12.4767 28.0162 12.4767 49.3454C12.4767 64.3482 21.0307 77.3554 33.529 83.7506C29.936 82.4027 26.56 80.5352 23.5089 78.2077Z"
              fill="#AC7DFF"
            />
            <path
              opacity="0.7"
              d="M13.7711 79.2177C5.38859 70.5392 0.7103 58.9406 0.725623 46.8749C0.725623 21.1232 21.6007 0.248093 47.3524 0.248093C54.0007 0.238733 60.5736 1.65658 66.6268 4.40583C50.0681 8.57888 13.2875 24.0577 13.7711 79.2177Z"
              fill="#D3BAFF"
            />
            <path
              d="M12.4733 49.3422C12.4733 64.3451 21.0273 77.3522 33.5256 83.7475C29.9339 82.4003 26.5591 80.5339 23.5088 78.2078V78.2078C14.074 71.016 7.98291 59.6567 7.98291 46.8749C7.98291 25.1311 25.6084 7.50882 47.3523 7.50882C52.4225 7.50259 57.4459 8.47829 62.1451 10.382L62.5346 10.544L62.6757 10.602L62.8836 10.6917C67.7146 12.7704 72.0812 15.7941 75.7266 19.5849C68.8056 13.8435 60.0922 10.7077 51.0997 10.7223C29.7673 10.7157 12.4733 28.0097 12.4733 49.3422Z"
              fill="#945EF2"
            />
            <path
              d="M86.0938 46.3155C86.0938 68.0572 68.4782 85.6816 46.7332 85.6816C43.1809 85.6838 39.6447 85.2053 36.2207 84.2592C38.8691 84.7994 41.5652 85.0707 44.2681 85.0689C66.3851 85.0689 84.3137 67.1403 84.3137 45.0233C84.3279 35.1571 80.6855 25.6356 74.09 18.2979C74.5007 18.602 74.9044 18.9139 75.3012 19.2333C82.2452 26.5385 86.11 36.2367 86.0938 46.3155V46.3155Z"
              fill="#AC7DFF"
            />
            <path
              d="M84.3133 45.0256C84.3133 67.1425 66.3847 85.0711 44.2678 85.0711C41.5649 85.073 38.8687 84.8017 36.2204 84.2615C34.6006 83.8143 33.0116 83.2628 31.4631 82.6104C20.096 75.8924 12.4731 63.5045 12.4731 49.342C12.4731 28.0062 29.7671 10.7188 51.0963 10.7188C59.3765 10.7052 67.4398 13.3654 74.0864 18.3034C80.6824 25.6398 84.3259 35.16 84.3133 45.0256V45.0256Z"
              fill="#D3BAFF"
            />
            <path
              d="M58.5007 54.3974L30.1274 71.0002L29.3422 68.0961C28.6514 65.549 28.8873 62.641 31.1625 61.3053C34.4783 59.3584 35.0801 59.0091 35.0801 59.0091C36.2711 57.5342 37.294 55.7237 38.1296 54.0459C39.3603 51.5757 40.1881 49.4088 40.5545 49.1071L39.289 47.4276L37.2647 44.7418L50.6677 36.9497L51.1236 37.966L47.558 46.0261C47.0939 46.0124 46.6313 46.0857 46.1941 46.2422C45.613 46.4481 45.0914 46.7936 44.675 47.2482C44.2587 47.7028 43.9603 48.2527 43.8061 48.8496C43.652 49.4465 43.6468 50.0722 43.7909 50.6716C43.9351 51.2709 44.2242 51.8258 44.6329 52.2873C45.0417 52.7488 45.5575 53.1029 46.135 53.3185C46.7126 53.5341 47.3343 53.6045 47.9454 53.5237C48.5566 53.4428 49.1385 53.2131 49.6402 52.8548C50.1418 52.4964 50.5478 52.0204 50.8224 51.4685L57.3247 51.7724L58.43 54.241L58.5007 54.3974Z"
              fill="url(#paint0_linear_2412_21)"
            />
            <path
              d="M61.9628 27.3525L59.5478 35.4475L62.7475 30.2057C63.0885 31.447 63.4378 32.7153 63.7787 33.9476L60.6934 42.3642L65.0404 38.4814C65.7036 40.8384 66.1844 42.504 66.2562 42.6262C66.5165 43.0683 61.729 49.1406 61.729 49.1406L57.4649 50.3122L56.6542 50.274L51.2196 50.0198C51.2664 49.2595 51.081 48.5029 50.688 47.8504C50.295 47.1978 49.713 46.6801 49.019 46.3658L51.9353 39.7685L60.2281 21C60.2281 21 60.9857 23.7814 61.9628 27.3525Z"
              fill="url(#paint1_linear_2412_21)"
            />
            <path
              d="M49.6211 49.0175C49.8032 49.5287 49.7984 50.0879 49.6076 50.5959C49.4167 51.1039 49.0522 51.528 48.5785 51.7928C48.1049 52.0577 47.5527 52.1463 47.02 52.0429C46.4872 51.9395 46.0083 51.6508 45.6681 51.228C45.5744 51.1123 45.4927 50.9873 45.4244 50.855C45.3735 50.7601 45.3299 50.6614 45.294 50.5599C45.1929 50.2757 45.1487 49.9743 45.1641 49.673C45.1795 49.3717 45.2541 49.0764 45.3836 48.804C45.5131 48.5315 45.6951 48.2873 45.919 48.0851C46.143 47.883 46.4046 47.727 46.6888 47.626V47.626C46.7507 47.6039 46.8143 47.5845 46.8784 47.5679C47.1485 47.4961 47.4296 47.4751 47.7073 47.506C48.1359 47.5538 48.5424 47.7209 48.8808 47.9881C49.2192 48.2554 49.4759 48.6122 49.6216 49.018L49.6211 49.0175Z"
              fill="url(#paint2_linear_2412_21)"
            />
            <defs>
              <linearGradient
                id="paint0_linear_2412_21"
                x1="36.218"
                y1="48.482"
                x2="47.9476"
                y2="63.8966"
                gradientUnits="userSpaceOnUse"
              >
                <stop stop-color="#AC7CFF" />
                <stop offset="1" stop-color="#7B3FE4" />
              </linearGradient>
              <linearGradient
                id="paint1_linear_2412_21"
                x1="53.239"
                y1="30.9276"
                x2="63.6482"
                y2="40.2179"
                gradientUnits="userSpaceOnUse"
              >
                <stop stop-color="#AC7CFF" />
                <stop offset="1" stop-color="#7B3FE4" />
              </linearGradient>
              <linearGradient
                id="paint2_linear_2412_21"
                x1="46.2849"
                y1="49.0477"
                x2="47.7936"
                y2="51.3362"
                gradientUnits="userSpaceOnUse"
              >
                <stop stop-color="#AC7CFF" />
                <stop offset="1" stop-color="#7B3FE4" />
              </linearGradient>
            </defs>
          </svg>
        </g>
      </svg>
    </div>
  );
};

export default Track;
