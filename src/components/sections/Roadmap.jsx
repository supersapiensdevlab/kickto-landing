import { gsap } from "gsap";
import { MotionPathPlugin } from "gsap/MotionPathPlugin.js";
import React, { useEffect } from "react";

const Track = () => {
  var offsetFromTop, pathBB, startY, finishDistance;
  var requestId;
  var tween;
  function update() {
    // Update our animation
    var value = (window.scrollY - startY) / pathBB.height;
    if (value < 1) tween.progress(value);
    //console.clear();
    console.log("distance Travelled:", window.scrollY - startY);
    console.log(
      "offsetFromTop",
      offsetFromTop,
      "window.scrollY",
      window.scrollY,
      "startY",
      startY,
      "pathBB",
      pathBB,
      "finishDistance",
      finishDistance,
      "value",
      value
    );
    // Let the scroll event fire again
    requestId = null;
  }

  useEffect(() => {
    window.scrollTo(0, 0);

    //console.clear();
    //register the plugin
    gsap.registerPlugin(MotionPathPlugin);

    // set the element to rotate from it's center
    // gsap.set([".rocket", ".rocket--self"], {
    // 	xPercent: -50,
    // 	yPercent: -50,
    // 	transformOrigin: "50% 50%"
    // });

    offsetFromTop = window.innerHeight * 0.5; //Vcenter of screen
    pathBB = document.querySelector("#path").getBoundingClientRect();
    startY = pathBB.top + offsetFromTop * 2;
    finishDistance = startY + pathBB.height - offsetFromTop;

    // the animation to use
    tween = gsap.to(".rocket", {
      paused: true,
      ease: "none",
      motionPath: {
        path: "#path",
        align: "#path",
        autoRotate: false,
        alignOrigin: [0.5, 0.5],
        start: 0.015,
      },
    });

    document.addEventListener("scroll", function () {
      // Prevent the update from happening too often (throttle the scroll event)
      if (!requestId) {
        requestId = requestAnimationFrame(update);
      }
    });
    update();
  }, []);

  return (
    <div className=" w-[1660px] h-[4000px] px-10  z-1  absolute  bg-red-100/30 overflow-clip">
      <svg
        className=""
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 1200 4000"
      >
        <svg
          viewBox="0 0 1056 7450"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            id="path"
            d="M539 1.5C619.5 252 4-23 4 368.5c0 488 1005 211.927 1005 749.46 0 506.04-986 149-977.5 704.5S1062 2022 1062 2554.5c0 418.5-1033.5 231.5-1022 729 9.8 423.92 487.5 177.5 495 611"
            stroke="#E1E1E1"
            stroke-width="7"
            vector-effect="non-scaling-stroke"
            stroke-dasharray="14 14"
          />
        </svg>

        <g class="rocket">
          <svg
            width="96"
            height="95"
            viewBox="0 0 96 95"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M68.0063 5.48249C61.9531 2.73324 55.3802 1.31539 48.7319 1.32475C22.9802 1.32366 2.104 22.1988 2.104 47.9505C2.10603 60.3158 7.01943 72.1741 15.7636 80.9172C24.5077 89.6603 36.3665 94.5723 48.7319 94.5729C74.4825 94.5729 95.3587 73.6967 95.3587 47.9461C95.3587 29.0733 84.1405 12.8154 68.0063 5.48249ZM24.8971 79.2834C15.4525 72.0916 9.36253 60.7322 9.36253 47.9505C9.36253 26.2066 26.988 8.58109 48.7319 8.58109C53.8021 8.57487 58.8255 9.55057 63.5247 11.4543L63.9142 11.6162L64.0554 11.6742L64.2632 11.764C69.0942 13.8427 73.4608 16.8663 77.1063 20.6571C70.1852 14.9158 61.4718 11.78 52.4793 11.7946C31.1436 11.7946 13.8562 29.0886 13.8562 50.4178C13.8562 65.4206 22.4102 78.4278 34.9085 84.823C31.3172 83.4758 27.9428 81.6094 24.8928 79.2834H24.8971Z"
              fill="#945EF2"
            />
            <path
              d="M65.9012 4.15876C59.848 1.40951 53.2751 -0.00833699 46.6268 0.0010226C20.8751 0.0010226 0 20.8761 0 46.6278C0.00116058 58.9936 4.91402 70.8525 13.658 79.5963C22.402 88.3401 34.2611 93.2527 46.6268 93.2535C72.3774 93.2535 93.2536 72.3773 93.2536 46.6267C93.2536 27.7495 82.0354 11.4917 65.9012 4.15876ZM22.7833 77.9596C13.3485 70.7679 7.25744 59.4085 7.25744 46.6267C7.25744 24.8829 24.883 7.26065 46.6268 7.26065C51.697 7.25442 56.7204 8.23012 61.4196 10.1339L61.8091 10.2958L61.9502 10.3538L62.1581 10.4435C66.9891 12.5222 71.3557 15.5459 75.0012 19.3367C68.0801 13.5953 59.3667 10.4596 50.3742 10.4741C29.0385 10.4741 11.7511 27.7681 11.7511 49.0973C11.7511 64.1002 20.3051 77.1073 32.8034 83.5026C29.2104 82.1547 25.8344 80.2872 22.7833 77.9596Z"
              fill="#AC7DFF"
            />
            <path
              opacity="0.7"
              d="M13.0455 78.9697C4.663 70.2912 -0.0152862 58.6926 3.75261e-05 46.6269C3.75261e-05 20.8752 20.8752 4.60383e-05 46.6269 4.60383e-05C53.2752 -0.00931356 59.848 1.40854 65.9012 4.15778C49.3425 8.33083 12.5619 23.8096 13.0455 78.9697Z"
              fill="#D3BAFF"
            />
            <path
              d="M11.7477 49.0942C11.7477 64.097 20.3017 77.1042 32.8 83.4994C29.2083 82.1522 25.8335 80.2859 22.7832 77.9598V77.9598C13.3484 70.768 7.25732 59.4086 7.25732 46.6269C7.25732 24.883 24.8828 7.26077 46.6267 7.26077C51.6969 7.25454 56.7203 8.23024 61.4195 10.134L61.809 10.2959L61.9501 10.3539L62.158 10.4436C66.989 12.5224 71.3556 15.546 75.0011 19.3368C68.08 13.5954 59.3666 10.4597 50.3741 10.4743C29.0417 10.4677 11.7477 27.7617 11.7477 49.0942Z"
              fill="#945EF2"
            />
            <path
              d="M85.3682 46.0675C85.3682 67.8091 67.7526 85.4336 46.0076 85.4336C42.4553 85.4357 38.9191 84.9573 35.4951 84.0112C38.1435 84.5514 40.8396 84.8227 43.5425 84.8208C65.6595 84.8208 83.5881 66.8922 83.5881 44.7753C83.6023 34.909 79.9599 25.3875 73.3644 18.0498C73.7751 18.354 74.1788 18.6658 74.5756 18.9853C81.5196 26.2904 85.3844 35.9886 85.3682 46.0675V46.0675Z"
              fill="#AC7DFF"
            />
            <path
              d="M83.5877 44.7775C83.5877 66.8945 65.6592 84.8231 43.5422 84.8231C40.8393 84.8249 38.1431 84.5537 35.4948 84.0134C33.8751 83.5663 32.286 83.0148 30.7375 82.3624C19.3704 75.6443 11.7476 63.2565 11.7476 49.0939C11.7476 27.7582 29.0415 10.4708 50.3707 10.4708C58.6509 10.4572 66.7142 13.1173 73.3608 18.0553C79.9568 25.3917 83.6003 34.912 83.5877 44.7775V44.7775Z"
              fill="#D3BAFF"
            />
            <path
              d="M57.7751 54.1494L29.4019 70.7521L28.6166 67.848C27.9258 65.3009 28.1618 62.393 30.4369 61.0573C33.7527 59.1104 34.3546 58.7611 34.3546 58.7611C35.5455 57.2861 36.5684 55.4757 37.404 53.7979C38.6347 51.3276 39.4625 49.1608 39.8289 48.859L38.5634 47.1796L36.5391 44.4938L49.9421 36.7017L50.398 37.718L46.8324 45.7781C46.3683 45.7644 45.9057 45.8377 45.4685 45.9942C44.8875 46.2001 44.3658 46.5455 43.9495 47.0001C43.5331 47.4548 43.2347 48.0047 43.0806 48.6016C42.9264 49.1985 42.9212 49.8241 43.0653 50.4235C43.2095 51.0229 43.4986 51.5777 43.9074 52.0392C44.3161 52.5008 44.8319 52.8549 45.4094 53.0704C45.987 53.286 46.6087 53.3565 47.2198 53.2756C47.831 53.1948 48.4129 52.9651 48.9146 52.6067C49.4162 52.2484 49.8222 51.7723 50.0968 51.2204L56.5991 51.5244L57.7044 53.993L57.7751 54.1494Z"
              fill="url(#paint0_linear_2412_21)"
            />
            <path
              d="M61.2372 27.1045L58.8222 35.1994L62.0219 29.9577C62.3629 31.1989 62.7122 32.4672 63.0532 33.6996L59.9678 42.1162L64.3148 38.2334C64.978 40.5904 65.4588 42.256 65.5306 42.3781C65.7909 42.8202 61.0034 48.8925 61.0034 48.8925L56.7393 50.0641L55.9286 50.026L50.494 49.7718C50.5408 49.0115 50.3554 48.2549 49.9624 47.6023C49.5694 46.9497 48.9874 46.432 48.2935 46.1178L51.2097 39.5205L59.5025 20.752C59.5025 20.752 60.2602 23.5334 61.2372 27.1045Z"
              fill="url(#paint1_linear_2412_21)"
            />
            <path
              d="M48.8955 48.7694C49.0776 49.2807 49.0728 49.8398 48.882 50.3479C48.6911 50.8559 48.3266 51.2799 47.8529 51.5448C47.3793 51.8097 46.8271 51.8983 46.2944 51.7949C45.7616 51.6915 45.2827 51.4028 44.9425 50.98C44.8488 50.8643 44.7671 50.7393 44.6988 50.607C44.6479 50.512 44.6043 50.4134 44.5684 50.3118C44.4673 50.0276 44.4232 49.7263 44.4385 49.425C44.4539 49.1237 44.5285 48.8284 44.658 48.5559C44.7876 48.2835 44.9695 48.0392 45.1934 47.8371C45.4174 47.635 45.679 47.4789 45.9632 47.3779V47.3779C46.0251 47.3558 46.0887 47.3365 46.1528 47.3199C46.4229 47.248 46.704 47.2271 46.9817 47.258C47.4103 47.3058 47.8168 47.4728 48.1552 47.7401C48.4936 48.0074 48.7503 48.3642 48.896 48.77L48.8955 48.7694Z"
              fill="url(#paint2_linear_2412_21)"
            />
            <defs>
              <linearGradient
                id="paint0_linear_2412_21"
                x1="35.4924"
                y1="48.234"
                x2="47.222"
                y2="63.6486"
                gradientUnits="userSpaceOnUse"
              >
                <stop stop-color="#AC7CFF" />
                <stop offset="1" stop-color="#7B3FE4" />
              </linearGradient>
              <linearGradient
                id="paint1_linear_2412_21"
                x1="52.5134"
                y1="30.6795"
                x2="62.9226"
                y2="39.9698"
                gradientUnits="userSpaceOnUse"
              >
                <stop stop-color="#AC7CFF" />
                <stop offset="1" stop-color="#7B3FE4" />
              </linearGradient>
              <linearGradient
                id="paint2_linear_2412_21"
                x1="45.5594"
                y1="48.7996"
                x2="47.068"
                y2="51.0882"
                gradientUnits="userSpaceOnUse"
              >
                <stop stop-color="#AC7CFF" />
                <stop offset="1" stop-color="#7B3FE4" />
              </linearGradient>
            </defs>
          </svg>
        </g>
      </svg>
    </div>
  );
};

export default Track;
